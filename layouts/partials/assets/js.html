{{- $mainScript := resources.Get "app/index.js" }}
{{- $configScript := resources.Get "app/config.template.js" | resources.ExecuteAsTemplate "config.js" . -}}
{{- $customScript := resources.Get "js/custom.js" -}}
{{- $scripts := slice $configScript $mainScript -}}
{{- if $.Site.Params.utterances -}}
  {{- $scripts = $scripts | append (resources.Get "js/utterances.js") -}}
{{- end -}}
{{- $scripts = $scripts | append $customScript -}}
{{- $script := $scripts | resources.Concat "js/app.js" | resources.Minify | resources.Fingerprint -}}
{{- $.Scratch.Add "hbs-assets" (slice (dict "url" $script.Permalink "revision" ($.Scratch.Get "null"))) -}}
<script src="{{ $script.Permalink }}" integrity="{{ $script.Data.Integrity }}" crossorigin="anonymous" defer></script>
{{- range .Site.Params.customJS -}}
<script src="{{ absURL . }}" crossorigin="anonymous"></script>
{{- end -}}

  {{- $iconsScript := resources.Get "icons/index.js" | minify | fingerprint -}}
  <script src="{{ $iconsScript.Permalink }}" integrity="{{ $iconsScript.Data.Integrity }}" crossorigin="anonymous" defer></script>

{{- if (default true .Site.Params.viewer) -}}
  {{- $viewerMainScript := resources.Get "viewer/index.js" }}
  {{- $viewerConfigScript := resources.Get "js/viewer.config.js" | resources.ExecuteAsTemplate "viewer.config.js" . -}}
  {{- $viewerScript := slice $viewerConfigScript $viewerMainScript | resources.Concat "js/viewer.js" -}}
  <script src="{{ $viewerScript.Permalink }}" integrity="{{ $viewerScript.Data.Integrity }}" crossorigin="anonymous" defer></script>
{{- end -}}